<html>

<head>
    <title>NoiseCapture interactive community map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/leaflet-sidebar.css" />
    <link rel="stylesheet" href="css/leaflet.awesome-markers.css">
    <link rel="stylesheet" href="css/languages.min.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/jqcloud.css" />
    <link href="css/flag-icon.min.css" rel="stylesheet">
    <link href="css/leaflet-search.min.css" rel="stylesheet" />
    <link href="css/L.Control.MousePosition.css" rel="stylesheet" />


	<link href="../assets/css/main.css" rel="stylesheet">
    <link href="../assets/css/font-awesome.min.css" rel="stylesheet">

    <link href='../assets/css/lato.css' rel='stylesheet' type='text/css'>
    <link href='../assets/css/raleway.css' rel='stylesheet' type='text/css'>

</head>

<body>

	<!------------------------------------------------------------------------------------------------------------------------------------------------------------------>
	<!-- NAVIGATION BAR -->

    <script src="./navbar.js"></script>

	<!------------------------------------------------------------------------------------------------------------------------------------------------------------------>
	<!-- Modal window -->

<div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Welcome to NoiseCapture world map</h4>
      </div>
      <div class="modal-body">
      <img style="width: 100%;" alt="Map guide" src="img/pop_up_ncp.png"/>
      <ol>
         <li>Zoom and navigate into the map. Some layers may be visible or not depending on the zoom level. Zoom on to visualize hidden layers.</li>
         <li>Select the party</li>
         <li>Party name and description</li>
         <li>Choose the layer(s) and the basemap you want to display</li>
         <li>Search an address, a city, a region, ...</li>
         <li>Once clicked on a measure, explore its informations</li>
         <li>List of the last measures uploaded. Click on a flag to zoom onto the measure</li>
         <li>Some statistics about the party</li>
        </ol>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

	<!------------------------------------------------------------------------------------------------------------------------------------------------------------------>
	<!-- SIDEBAR -->

	<div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-question-circle"></i></a></li>
                <li><a href="#hexainfo" role="tab"><i class="fa fa-pie-chart"></i></a></li>
                <li><a href="#history" role="tab" onclick="setTimeout(onomap.getHistory(), 200)"><i class="fa fa-history"></i></a></li>
                <li><a href="#statistics" role="tab"  onclick="setTimeout(loadStatistics,200)"><i class="fa fa-line-chart"></i></a></li>
				<li><a href="#about" role="tab"><i class="fa fa-copyright"></i></a></li>
            </ul>
            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        </div>
        <!-- Tab panes -->
        <div class="sidebar-content">

			<div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">Home</h1><span class="sidebar-close"><font color="white"><i class="fa fa-caret-left fa-2x" ></i></font></span>
                <h3 id="noisecapture_party_title"></h3>
                <p id="noisecapture_party_description"></p>
                <h3>Explore the noisemaps</h3>
                <p>The following map represent all collected data using the NoiseCapture application. You can navigate on the map, select the layers, explore your noise environment...</p>
                <h3>Contribute to the noisemaps</h3>
                <p>Download the NoiseCapture Android App, realize measurements and transfer data to the community...</p>
                <div class="centered">
                    <a href="https://play.google.com/store/apps/details?id=org.noise_planet.noisecapture"><img style="width: 164px; height: 63px;" alt="Get it on Google Play" src="img/en_badge_web_generic.png"></a><br>
                </div>
				<hr>
				<h4><i class="fa fa-exclamation-circle" aria-hidden="true"></i> Disclaimer</h4>
                <p align="justify">The data provided on this site result from a research project. It has no legal force and serves for information purposes only. Absolutely no accuracy or completeness guarantee is implied or intended.
				The authors are not responsible for the direct or indirect consequences of the uses or interpretation of the information provided.</p>
				<hr>
            </div>

			<div class="sidebar-pane" id="history">
                <h1 class="sidebar-header">History</h1><span class="sidebar-close"><font color="white"><i class="fa fa-caret-left fa-2x" ></i></font></span>
                <h3>Last measurements</h3> <input type="checkbox" id="auto_track" onchange='onomap.setAutoTrack(this.checked);'>&nbsp;<label for="auto_track">Auto follow new measurements</label>
				<span class="label label-primary"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><b> Click on the flag to show the measure</b> </span>
                <div id="measures_log"></div>
            </div>

			<div class="sidebar-pane" id="statistics">
                <h1 class="sidebar-header">Statistics</h1><span class="sidebar-close"><font color="white"><i class="fa fa-caret-left fa-2x" ></i></font></span>

                <h4>Summary<a><i class="fa fa-refresh" onclick="loadStatistics()"></i>
        				<span class="sr-only">Refresh</span></a></h4>

                    <table class="table">
                   <thead>
                     <tr>
                       <th></th>
                       <th>NoiseCapture party</th>
                     </tr>
                   </thead>
                   <tbody>
                     <tr>
                       <td>Number of contributors</td>
                       <td id="statistics_total_contributors"></td>
                     </tr>
                     <tr>
                       <td>Number of measurements</td>
                       <td id="statistics_total_tracks"></td>
                     </tr>
                     <tr>
                       <td>Total duration</td>
                       <td id="statistics_total_tracks_duration"></td>
                     </tr>
                   </tbody>
                 </table>
                 <h4>Best contributors</h4>
                 <div id="ranks"></div>
            </div>

			<div class="sidebar-pane" id="about">
                <h1 class="sidebar-header">About</h1><span class="sidebar-close"><font color="white"><i class="fa fa-caret-left fa-2x" ></i></font></i></span>
                <h3>Licenses</h3>
					<h4>Web page</h4>
					<p>This page is a publication of the Universit√© Gustave Eiffel and of the CNRS (Centre national de la recherche scientifique). Unless specified otherwise, the content on this website is properties of Univ Eiffel and CNRS.
					</p>
					<h4>NoiseCapture Android App</h4>
					<p>NoiseCapture Android App is a free software; you can redistribute it and/or modify it under the terms of the GNU
					General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.
					<a href="../noisecapture.html"><i class="fa fa-plus-circle" aria-hidden="true"></i></a></p>
					<h4>Collected raw data</h4>
					<p>All raw data collected from the NoiseCapture Android App, i.e. the DATABASE-NoiseCaptureRaw, are made available under the Open Database
					License. Any rights in individual contents of the database are licensed under the Database Contents License.
					<a href="http://data.noise-planet.org/index.html"><i class="fa fa-plus-circle" aria-hidden="true"></i></a></p>
				<h3>Privacy</h3>
					<p>All collected data are anonymous.
					<a href="../NoiseCapture_privacy_policy_history.html"><i class="fa fa-plus-circle" aria-hidden="true"></i></a></p>
				<h3>Information</h3>
					<h4>Follow us</h4>
					<a target="_blank" href="https://twitter.com/search?q=%40Noise_planet&src=typd"><img title="Follow @Noise_Planet" alt="Follow @Noise_Planet" src="https://img.shields.io/twitter/follow/Noise_Planet.svg?style=social&amp;label=Follow" /></a>
					<a target="_blank" href="https://github.com/Ifsttar/NoiseCapture/subscription"> <img title="Watch NoiseCapture" alt="Watch NoiseCapture" src="https://img.shields.io/github/watchers/ifsttar/noisecapture.svg?style=social&amp;label=Watch" /></a>
					<h4>Contact us</h4>
                <p>For any questions involving the project and the data, please contact us at <a title="mailt ot: noisecapture@noise-planet.org" href="mailto:noisecapture@noise-planet.org">noisecapture(at)noise-planet.org</a>
                </p>
            </div>


            <div class="sidebar-pane" id="hexainfo">
                <h1 class="sidebar-header">Selected area</h1><span class="sidebar-close"><font color="white"><i class="fa fa-caret-left fa-2x" ></i></font></span>
                <h3>Explore the mean noise of your environment</h3>
  			<p>Results are obtained from all collected measurements, without filtering.</p>
  			<span class="label label-primary"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><b> Select an hexagon to show results</b> </span>
                <div id="areainfo"></div>
  			<br>
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#la50">LA50 <i class="fa fa-info-circle" aria-hidden="true" title="The LA50 is the A-weighted noise level that is exceeded for 50% of the measurement period. It is a good descriptor of the mean sound level in the environment."></i></a></li>
                    <!--<li><a data-toggle="tab" href="#lden">Lden</a></li>-->
                    <li><a data-toggle="tab" href="#laeq">LAeq <i class="fa fa-info-circle" aria-hidden="true" title="The LAeq is the A-weighted noise level. It is a standard descriptor of the perceived sound level in the environment."></i></a></li>
                </ul>
                <div class="tab-content">
                    <div id="la50" class="tab-pane fade in active">
                        <div>
                            <div>
                                <h4 class='attribute_label' style="margin-bottom:0.5em">Working days <i class="fa fa-info-circle" aria-hidden="true" title="The following chart show the temporal evolution of the noise level over the 24h of a working day."></i></h3>
                                <canvas id="statistics_working_day_la50"></canvas>
                            </div>
                            <div>
                                <h4 class='attribute_label' style="margin-bottom:0.5em">Saturday <i class="fa fa-info-circle" aria-hidden="true" title="The following chart show the temporal evolution of the noise level over the 24h of a saturday."></i></h3>
                                <canvas id="statistics_saturday_la50"></canvas>
                            </div>
                            <div>
                                <h4 class='attribute_label' style="margin-bottom:0.5em">Sunday <i class="fa fa-info-circle" aria-hidden="true" title="The following chart show the temporal evolution of the noise level over the 24h of a sunday."></i></h3>
                                <canvas id="statistics_sunday_la50"></canvas>
                            </div>
                        </div>

  				</div>

  				<div id="laeq" class="tab-pane fade in">
  						<div>
  							<div>
  								<h4 class='attribute_label' style="margin-bottom:0.5em">Working days <i class="fa fa-info-circle" aria-hidden="true" title="The following chart show the temporal evolution of the noise level over the 24h of a working day."></i></h3>
                  <canvas id="statistics_working_day_laeq"></canvas>
  							</div>
  							<div>
  								<h4 class='attribute_label' style="margin-bottom:0.5em">Saturday <i class="fa fa-info-circle" aria-hidden="true" title="The following chart show the temporal evolution of the noise level over the 24h of a saturday."></i></h3>
                  <canvas id="statistics_saturday_laeq"></canvas>
  							</div>
  							<div>
  								<h4 class='attribute_label' style="margin-bottom:0.5em">Sunday <i class="fa fa-info-circle" aria-hidden="true" title="The following chart show the temporal evolution of the noise level over the 24h of a sunday."></i></h3>
                  <canvas id="statistics_sunday_laeq"></canvas>
  							</div>
  						</div>
          </div>

        </div>
        <h4>Tags <i class="fa fa-info-circle" aria-hidden="true" title="Tags cloud provided by users for this area"></i></a></h4>
        <div id="area_tags" style="width: 385px; height: 200px;"></div>
      </div>

			<div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings</h1><span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                <!-- http://usrz.github.io/bootstrap-languages/ -->
                <!--  -->
                <h4>Time format language:</h4>
                <div class="btn-group dropdown">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
					<span id="time_lang" class="lang-sm lang-lbl-full" lang="en"></span> <span class="caret"></span>
					</button>
                    <ul id="time_lang_list" class="dropdown-menu" role="menu">
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="bg"></span></a></li>
                        <!-- Bulgarian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="hr"></span></a></li>
                        <!-- Croatian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="cs"></span></a></li>
                        <!-- Czech -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="da"></span></a></li>
                        <!-- Danish -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="nl"></span></a></li>
                        <!-- Dutch -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="en"></span></a></li>
                        <!-- English -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="el"></span></a></li>
                        <!-- Croatian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="et"></span></a></li>
                        <!-- Estonian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="fi"></span></a></li>
                        <!-- Finish -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="fr"></span></a></li>
                        <!-- French -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="de"></span></a></li>
                        <!-- German -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="el"></span></a></li>
                        <!-- Greek -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="hu"></span></a></li>
                        <!-- Hungarian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="ga"></span></a></li>
                        <!-- Irish -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="it"></span></a></li>
                        <!-- Italian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="lv"></span></a></li>
                        <!-- Latvian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="lt"></span></a></li>
                        <!-- Lithuanian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="mt"></span></a></li>
                        <!-- Maltese -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="pl"></span></a></li>
                        <!-- Polish -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="pt"></span></a></li>
                        <!-- Portuguese -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="ro"></span></a></li>
                        <!-- Romanian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="sk"></span></a></li>
                        <!-- Slovak -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="sl"></span></a></li>
                        <!-- Slovenian -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="es"></span></a></li>
                        <!-- Spanish -->
                        <li><a role="menuitem" tabindex="-1"><span class="lang-sm lang-lbl-full" lang="sv"></span></a></li>
                        <!-- Swedish -->
                    </ul>
                </div>
                <h4>Time format zone:</h4>
                <label class="radio-inline"><input type="radio" name="tz-option"> Browser timezone</label><br>
                <label class="radio-inline"><input onsite type="radio" name="tz-option" checked> Measurement location timezone</label>
            </div>
        </div>
    </div>
	<div id="map" class="sidebar-map"></div>
	<!-- Javascript placed at the end of the document so the pages load faster -->
  <script src="js/jquery.js"></script>
	<script type="text/javascript">window.liveSettings={api_key:"4c31aac0398149cf971660ee00d6106b"};</script>
	<script type="text/javascript" src="//cdn.transifex.com/live.js"></script>
	<script src="js/leaflet.js"></script>
    <script src="js/proj4.js"></script>
    <script src="js/onomap.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/leaflet-sidebar.js"></script>
    <script src="js/leaflet.wms.js"></script>
    <script src="js/leaflet-search.min.js"></script>
    <script src="js/moment-with-locales.min.js"></script>
    <script src="js/Chart.min.js"></script>
    <script src="js/leaflet.awesome-markers.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/L.Control.MousePosition.js"></script>
    <script src="js/jqcloud-1.0.4.min.js"></script>
    <script>

        var noisePartyList = null;

        //var server_url = 'http://127.0.0.1:8085/geoserver/';
        var server_url = 'https://onomap-gs.noise-planet.org/geoserver/';

        var map = L.map('map').setView([47.175, 12.524], 5);

        var sidebar = L.control.sidebar('sidebar').addTo(map);

        var osm = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {
        maxZoom: 18, attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attribution">CARTO</a>'});

        var esriworldimagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        });

        var onomap = createOnomap({server_url: server_url, map: map});
        onomap.onAdd(map);

        var onomap_hexa = L.tileLayer.wms(server_url+'ows?', {
            layers: 'noisecapture:noisecapture_area_party',
            format: 'image/png',
            transparent: true,
            minZoom: 14,
            crs: L.CRS.EPSG900913
        });

        var onomap_points = L.tileLayer.wms(server_url+'ows?', {
            layers: 'noisecapture:noisecapture_points_party',
            format: 'image/png',
            transparent: true,
            minZoom: 14,
            styles: 'noisecapture_points_party',
            crs: L.CRS.EPSG900913
        });

        var onomap_points_cluster = L.tileLayer.wms(server_url+'ows?', {
            layers: 'noisecapture:noisecapture_points_party',
            format: 'image/png',
            transparent: true,
            minZoom: 8,
            maxZoom: 13,
            styles: 'noisecapture_points_pointStacker',
            crs: L.CRS.EPSG900913
        });

        L.control.scale({
            'position': 'bottomright',
            'metric': true,
            'imperial': false
        }).addTo(map);

        L.control.mousePosition().addTo(map);

        new L.Control.Search({
            url: 'https://nominatim.openstreetmap.org/search?format=json&q={s}',
            jsonpParam: 'json_callback',
            propertyName: 'display_name',
            propertyLoc: ['lat', 'lon'],
            markerLocation: true,
            autoType: false,
            autoCollapse: true,
            minLength: 2,
            zoom: 15
        }).addTo(map);




        var noiseparty_list = L.control({position: 'topright'});
        var doAutoFly = false;
        var sel = document.createElement("select");
        sel.onchange = function() {
            // If the user change NoiseParty
            if("party" in map.options) {
              map.options["party"].forceBounds = true;
            }
            loadNoiseParty(sel.value)
        };

        noiseparty_list.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend');
            div.appendChild(sel);
            div.firstChild.onmousedown = div.firstChild.ondblclick = L.DomEvent.stopPropagation;
            return div;
        };
        noiseparty_list.addTo(map);

        map.addLayer(osm)
        map.addLayer(onomap_hexa)
        map.addLayer(onomap_points_cluster)

        var baseLayers = {
            "OpenStreetMap": osm,
            "Images satellites": esriworldimagery
        };

        L.control.layers(baseLayers, {
            "Sound level (LA50)": onomap_hexa,
            "Measures location": onomap_points,
            "Measures counting": onomap_points_cluster
        }).addTo(map);

        var hash = new L.Hash(map);

        // Load default area info
        onomap.showGetFeatureInfo(null, null, []);

        function loadNoiseParty(noiseparty_id) {

          var loadBounds = !("party" in map.options) || ("party" in map.options && map.options["party"].forceBounds);

          map.options["party"] = noisePartyList[noiseparty_id];
          onomap.loadNoiseCaptureParty(noisePartyList[noiseparty_id]);

          onomap_points_cluster.setParams({cql_filter: 'pk_party=' + noisePartyList[noiseparty_id].pk_party});
          onomap_points.setParams({cql_filter: 'pk_party=' + noisePartyList[noiseparty_id].pk_party});
          onomap_hexa.setParams({cql_filter: 'pk_party=' + noisePartyList[noiseparty_id].pk_party});

          // Update texts
          document.getElementById('noisecapture_party_title').innerHTML = noisePartyList[noiseparty_id].title;
          document.getElementById('noisecapture_party_description').innerHTML = noisePartyList[noiseparty_id].description;

          // Zoom to noisecapture party
          if(loadBounds) {
            var bounds = noisePartyList[noiseparty_id].geometry.coordinates[0];
            map.fitBounds([
            [bounds[0][1], bounds[0][0]],
            [bounds[2][1], bounds[2][0]]
            ]);
          }

          sidebar.open('home');
        }

        function doHistoRefresh() {
            onomap.getHistory();
        }

            function length_to_dd_hh_mm_ss(seconds) {
              if (seconds == 0) {
                return "0s";
              }
              // calculate (and subtract) whole days
              var days = Math.floor(seconds / 86400);
              seconds -= days * 86400;

              // calculate (and subtract) whole hours
              var hours = Math.floor(seconds / 3600) % 24;
              seconds -= hours * 3600;

              // calculate (and subtract) whole minutes
              var minutes = Math.floor(seconds / 60) % 60;
              seconds -= minutes * 60;

              // what's left is seconds
              var seconds = seconds % 60; // in theory the modulus is not required
              if (days > 0) {
                return Transifex.live.translateText("{days}d {hours}h{minutes}m", { days: days, hours:hours, minutes:minutes})
              } else if (hours > 0) {
                return Transifex.live.translateText("{hours}h{minutes}m", { hours:hours, minutes:minutes})
              } else if (minutes > 0) {
                return Transifex.live.translateText("{minutes}m{seconds}s", { hours:hours, minutes:minutes, seconds:seconds})
              } else {
                return Transifex.live.translateText("{seconds}s", {seconds:seconds})
              }
            }

            function loadStatistics() {
              if(noisePartyList == null || noisePartyList.length <= sel.selectedIndex) {
                return;
              }
              var party_data = noisePartyList[sel.selectedIndex];
              var postData = `<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">
                <ows:Identifier>groovy:nc_party_get_stats</ows:Identifier>
                <wps:DataInputs>
                  <wps:Input>
                    <ows:Identifier>noiseparty</ows:Identifier>
                    <wps:Data>
                      <wps:LiteralData>`+party_data.pk_party+`</wps:LiteralData>
                    </wps:Data>
                  </wps:Input>
                </wps:DataInputs>
                <wps:ResponseForm>
                  <wps:RawDataOutput>
                    <ows:Identifier>result</ows:Identifier>
                  </wps:RawDataOutput>
                </wps:ResponseForm>
              </wps:Execute>
              `
              // Retrieve stored statistics file
              var url = server_url+'ows' + L.Util.getParamString(params, '', true);
              $.ajax({
                type: 'POST',
                crossDomain: true,
                data: postData,
                contentType: "text/plain",
                dataType: "json",
                url: url,
                success: function(data) {
                  document.getElementById('statistics_total_contributors').innerHTML = data["total_contributors"];
                  document.getElementById('statistics_total_tracks').innerHTML = data["total_tracks"];
                  document.getElementById('statistics_total_tracks_duration').innerHTML = length_to_dd_hh_mm_ss(data["total_tracks_duration"]);
                  var users = data["contributors"];
                  var rankDiv = document.getElementById('ranks');
                  onomap.loadUserRanksTable(rankDiv, users);
                }
              });


            }

            function loadPartyList() {
              // Load noisecapture party events
              var postData = `<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">
                      <ows:Identifier>groovy:nc_noiseparty_list</ows:Identifier>
                      <wps:DataInputs/>
                      <wps:ResponseForm>
                        <wps:RawDataOutput>
                          <ows:Identifier>result</ows:Identifier>
                        </wps:RawDataOutput>
                      </wps:ResponseForm>
                    </wps:Execute>`;
              params = {
                request: 'Execute',
                service: 'wps',
                version: '1.0.0',
                Identifier: 'groovy:nc_noiseparty_list'
              };
              var url = server_url+'ows' + L.Util.getParamString(params, '', true);
              $.ajax({
                type: 'POST',
                crossDomain: true,
                data: postData,
                contentType: "text/plain",
                dataType: "json",
                url: url,
                success: function(data) {
                  noisePartyList = data;
                  var partyIndex = -1;
                  var urlData = L.Hash.parseHash(location.hash);
                  var party_layer_name = urlData.party;
                  map.options["party"] = {layer_name: party_layer_name, forceBounds: urlData.forceBounds};
                  for (i = 0; i < data.length; i++) {
                    var row = data[i];
                    var opt = document.createElement("option");
                    opt.value = i;
                    opt.text = row.title;
                    if(party_layer_name == row.layer_name) {
                      partyIndex = i;
                      opt.selected = true;
                    }
                    sel.appendChild(opt);
                  }
                  if(partyIndex > -1 && data.length > partyIndex) {
                    loadNoiseParty(partyIndex);
                  }
                },
                  error : timeout_onomap,
                    timeout: 5000
              });
          }
          loadPartyList();
          $('#basicModal').modal('show')
    </script>
</body>

</html>
